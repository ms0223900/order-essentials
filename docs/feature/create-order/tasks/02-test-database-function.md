# 任務：測試整合的資料庫函數

## 任務描述
為新建立的 `create_order_with_inventory_deduction` 函數撰寫完整的測試案例，驗證其功能正確性和錯誤處理能力。

## 輸入格式
- **測試資料**:
  - 有效的顧客資訊和商品項目
  - 庫存不足的測試案例
  - 商品不存在的測試案例
  - 無效輸入參數的測試案例

## 輸出格式
- **測試結果**: 通過/失敗狀態
- **測試覆蓋率報告**: 涵蓋的測試案例數量
- **錯誤訊息**: 當測試失敗時的詳細資訊

## 測試案例
1. **成功建立訂單**
   - 輸入: 有效的顧客資料和足夠庫存的商品
   - 預期: 成功建立訂單，庫存正確扣減

2. **庫存不足錯誤**
   - 輸入: 請求數量超過可用庫存的商品
   - 預期: 交易回滾，返回庫存不足錯誤

3. **商品不存在錯誤**
   - 輸入: 不存在的商品 ID
   - 預期: 返回商品不存在錯誤

4. **無效輸入參數**
   - 輸入: null 值或格式錯誤的參數
   - 預期: 返回參數驗證錯誤

5. **批量商品處理**
   - 輸入: 多個商品的訂單
   - 預期: 正確處理所有商品的庫存扣減

6. **交易原子性**
   - 輸入: 部分商品庫存不足的訂單
   - 預期: 整個交易回滾，無任何資料變更

## 驗收條件
- [ ] 所有測試案例都通過
- [ ] 涵蓋成功和失敗場景
- [ ] 驗證資料庫交易的原子性
- [ ] 驗證錯誤訊息的準確性
- [ ] 測試資料在測試後正確清理
- [ ] 提供測試執行腳本或指令

## 依賴關係
- **前置依賴**: 01-create-integrated-database-function（需要測試的函數）
- **後續依賴**:
  - 03-extend-repository-interface（需要在領域層呼叫此函數）
  - 04-update-order-types（需要更新類型定義）
